<!DOCTYPE HTML>
<html>
<head>
  <meta charset="utf-8" />
  
  <title>独钓寒江雪</title>

  
  <meta name="author" content="John Doe" />
    

  <meta
    id="viewport"
    name="viewport"
    content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no, minimal-ui" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />

  

  <meta property="og:site_name" content="独钓寒江雪" />

  
  <meta property="og:image" content="/favicon.ico" />
  

  <link href="/favicon.ico" rel="icon" />
  <link
    rel="alternate"
    href="/atom.xml"
    title="独钓寒江雪"
    type="application/atom+xml" />
  <link rel="stylesheet" href="/css/style.css" media="screen" type="text/css" />

  <script
    async
    src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-9313450459437229"
    crossorigin="anonymous"></script>
<meta name="generator" content="Hexo 8.0.0"></head>


<body>
<div class="blog">
  <div class="content">

    <header>
  <div class="site-branding">
    <h1 class="site-title">
      <a href="/">独钓寒江雪</a>
    </h1>
    <p class="site-description"></p>
  </div>
  <nav class="site-navigation">
    <ul>
      
        <li><a href="/">首页</a></li>
      
        <li><a href="/archives">归档</a></li>
      
        <li><a href="/tags">标签</a></li>
      
        <li><a href="/about">关于</a></li>
      
    </ul>
  </nav>
</header>

    <main class="site-main posts-loop">
    
  <article>

  
    
    <h3 class="article-title"><a href="/2025/12/08/elixir-marco/"><span>elixir 之宏</span></a></h3>
    
  

  <div class="article-top-meta">
    <span class="posted-on">
      <a href="/2025/12/08/elixir-marco/" rel="bookmark">
        <time class="entry-date published" datetime="2025-12-08T00:37:41.000Z">
          2025-12-08
        </time>
      </a>
    </span>
  </div>


  

  <div class="article-content">
    <div class="entry">
      
        <h2 id="关键字"><a href="#关键字" class="headerlink" title="关键字"></a>关键字</h2><h3 id="require"><a href="#require" class="headerlink" title="require"></a>require</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">导入宏, 否则不能调用宏的方法</span><br></pre></td></tr></table></figure>

<h3 id="use"><a href="#use" class="headerlink" title="use"></a>use</h3><p>给模块动态增加方法</p>
<p>相当于</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">require XXX</span><br><span class="line">XXX.__using__</span><br></pre></td></tr></table></figure>

<h3 id="quote"><a href="#quote" class="headerlink" title="quote"></a>quote</h3><p>生成当前表达式的语法树，必须要在 defmacro 语句的里面才能用</p>
<h3 id="unquote"><a href="#unquote" class="headerlink" title="unquote"></a>unquote</h3><p>说明</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">把 语法树转换为实际表达式，一般和 `quote` 一起组合成为新的 ast，必须在宏里面才能用</span><br></pre></td></tr></table></figure>

<p>使用场景</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">defmacro 关键字修饰的函数参数，如果要使用它作为变量，则需要 `unquote`</span><br></pre></td></tr></table></figure>

<h2 id="宏调试"><a href="#宏调试" class="headerlink" title="宏调试"></a>宏调试</h2><h3 id="例子"><a href="#例子" class="headerlink" title="例子"></a>例子</h3><figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">defmodule</span> <span class="title">SimpleMacro</span></span> <span class="keyword">do</span></span><br><span class="line">  <span class="function"><span class="keyword">defmacro</span> <span class="title">plus</span></span>(ast_x, ast_y) <span class="keyword">do</span></span><br><span class="line">    <span class="keyword">quote</span> <span class="keyword">do</span></span><br><span class="line">      <span class="keyword">unquote</span>(ast_x) + <span class="keyword">unquote</span>(ast_y)</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">ast =</span><br><span class="line">  <span class="keyword">quote</span> <span class="keyword">do</span></span><br><span class="line">    <span class="title class_">SimpleMacro</span>.plus(x, <span class="number">23</span>)</span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line">ast |&gt; <span class="title class_">Macro</span>.expand(__ENV__) |&gt; <span class="title class_">Macro</span>.to_string</span><br></pre></td></tr></table></figure>

<h2 id="基础用法"><a href="#基础用法" class="headerlink" title="基础用法"></a>基础用法</h2><h3 id="普通例子"><a href="#普通例子" class="headerlink" title="普通例子"></a>普通例子</h3><figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">defmodule</span> <span class="title">DemoMacro</span></span> <span class="keyword">do</span></span><br><span class="line">  <span class="function"><span class="keyword">defmacro</span> <span class="title">plus</span></span>(ast_x, ast_y) <span class="keyword">do</span></span><br><span class="line">    <span class="keyword">quote</span> <span class="keyword">do</span></span><br><span class="line">      <span class="keyword">unquote</span>(ast_x) + <span class="keyword">unquote</span>(ast_y)</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>

<p>测试</p>
<figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">require</span> <span class="title class_">DemoMacro</span></span><br><span class="line"><span class="title class_">DemoMacro</span>.plus(<span class="number">11</span>,<span class="number">22</span>)</span><br></pre></td></tr></table></figure>

<h3 id="bind-quoted"><a href="#bind-quoted" class="headerlink" title="bind_quoted"></a>bind_quoted</h3><p>bind_quoted 绑定的值会保持不变</p>
<p>代码如下</p>
<figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">defmodule</span> <span class="title">DemoMacro</span></span> <span class="keyword">do</span></span><br><span class="line">  <span class="keyword">require</span> <span class="title class_">Logger</span></span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">defmacro</span> <span class="title">double_puts</span></span>(expr) <span class="keyword">do</span></span><br><span class="line">    <span class="keyword">quote</span> <span class="keyword">do</span></span><br><span class="line">      <span class="title class_">Logger</span>.debug(<span class="keyword">unquote</span>(expr))</span><br><span class="line">      <span class="title class_">Logger</span>.debug(<span class="keyword">unquote</span>(expr))</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>

<figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">defmodule</span> <span class="title">DemoMacro</span></span> <span class="keyword">do</span></span><br><span class="line">  <span class="keyword">require</span> <span class="title class_">Logger</span></span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">defmacro</span> <span class="title">double_puts</span></span>(expr) <span class="keyword">do</span></span><br><span class="line">    <span class="keyword">quote</span> <span class="symbol">bind_quoted:</span> [<span class="symbol">aaa:</span> expr] <span class="keyword">do</span></span><br><span class="line">      <span class="title class_">Logger</span>.debug(aaa)</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>

<p>测试</p>
<figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">require</span> <span class="title class_">DemoMacro</span></span><br><span class="line"><span class="title class_">DemoMacro</span>.double_puts(<span class="symbol">:os</span>.system_time)</span><br></pre></td></tr></table></figure>

<h2 id="使用场景"><a href="#使用场景" class="headerlink" title="使用场景"></a>使用场景</h2><p><a target="_blank" rel="noopener" href="https://blog.appsignal.com/2021/10/26/how-to-use-macros-in-elixir.html">参考链接</a></p>
<h3 id="动态添加方法和属性"><a href="#动态添加方法和属性" class="headerlink" title="动态添加方法和属性"></a>动态添加方法和属性</h3><p>use 模块除了在模块调用 <code>__using__</code> 宏外, 不做其他任何事情</p>
<p>注意 <code>require</code> 的位置</p>
<figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">defmodule</span> <span class="title">DemoMacro</span></span> <span class="keyword">do</span></span><br><span class="line">  <span class="function"><span class="keyword">defmacro</span> <span class="title">demo</span></span>(name) <span class="keyword">do</span></span><br><span class="line">    <span class="keyword">quote</span> <span class="keyword">do</span></span><br><span class="line">      <span class="keyword">unquote</span>(name) &lt;&gt; <span class="string">&quot;, &quot;</span> &lt;&gt; <span class="string">&quot;in DemoMacro&quot;</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">defmodule</span> <span class="title">DemoUsing</span></span> <span class="keyword">do</span></span><br><span class="line">  <span class="function"><span class="keyword">defmacro</span> <span class="title">__using__</span></span>(opts) <span class="keyword">do</span></span><br><span class="line">    params = <span class="title class_">Keyword</span>.get(opts, <span class="symbol">:aaa</span>, <span class="string">&quot;default params&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">quote</span> <span class="keyword">do</span></span><br><span class="line">      <span class="keyword">require</span> <span class="title class_">DemoMacro</span></span><br><span class="line">      <span class="function"><span class="keyword">def</span> <span class="title">demo</span></span>(name) <span class="keyword">do</span></span><br><span class="line">        value = <span class="string">&quot;value from &quot;</span> &lt;&gt; <span class="keyword">unquote</span>(params) &lt;&gt; <span class="string">&quot;, &quot;</span> &lt;&gt; name</span><br><span class="line">        <span class="title class_">DemoMacro</span>.demo(value)</span><br><span class="line">      <span class="keyword">end</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">defmodule</span> <span class="title">Demo</span></span> <span class="keyword">do</span></span><br><span class="line">  <span class="keyword">use</span> <span class="title class_">DemoUsing</span>, <span class="symbol">aaa:</span> <span class="string">&quot;123&quot;</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>

<p>测试</p>
<figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Demo</span>.demo(<span class="string">&quot;me&quot;</span>)</span><br></pre></td></tr></table></figure>

<h3 id="方法重写"><a href="#方法重写" class="headerlink" title="方法重写"></a>方法重写</h3><figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">defmodule</span> <span class="title">DemoUsing</span></span> <span class="keyword">do</span></span><br><span class="line">  <span class="function"><span class="keyword">defmacro</span> <span class="title">__using__</span></span>(_opts) <span class="keyword">do</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">quote</span> <span class="keyword">do</span></span><br><span class="line">      <span class="function"><span class="keyword">def</span> <span class="title">test1</span></span>(x, y) <span class="keyword">do</span></span><br><span class="line">        x + y</span><br><span class="line">      <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">      <span class="function"><span class="keyword">def</span> <span class="title">test2</span></span>(x, y) <span class="keyword">do</span></span><br><span class="line">        x - y</span><br><span class="line">      <span class="keyword">end</span></span><br><span class="line">      defoverridable <span class="symbol">test1:</span> <span class="number">2</span>, <span class="symbol">test2:</span> <span class="number">2</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">defmodule</span> <span class="title">Demo</span></span> <span class="keyword">do</span></span><br><span class="line">  <span class="keyword">use</span> <span class="title class_">DemoUsing</span></span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">test1</span></span>(x, y) <span class="keyword">do</span></span><br><span class="line">    <span class="comment"># 调用默认实现</span></span><br><span class="line">    super(x, y)</span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">test2</span></span>(x, y) <span class="keyword">do</span></span><br><span class="line">    x * y * y</span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>

<p>测试</p>
<figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Demo</span>.test1(<span class="number">11</span>, <span class="number">22</span>)</span><br><span class="line"><span class="title class_">Demo</span>.test2(<span class="number">11</span>, <span class="number">22</span>)</span><br></pre></td></tr></table></figure>

<h3 id="behaviour-重写"><a href="#behaviour-重写" class="headerlink" title="behaviour 重写"></a>behaviour 重写</h3><figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">defmodule</span> <span class="title">DemoBehaviour</span></span> <span class="keyword">do</span></span><br><span class="line">  <span class="variable">@callback</span> demo(number(), number()) :: number()</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># defoverridable 使用 Behaviour 当参数的时候，所有 callback 都可以被 override</span></span><br><span class="line"><span class="class"><span class="keyword">defmodule</span> <span class="title">DemoUsing</span></span> <span class="keyword">do</span></span><br><span class="line">  <span class="keyword">require</span> <span class="title class_">Logger</span></span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">defmacro</span> <span class="title">__using__</span></span>(_opts) <span class="keyword">do</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">quote</span> <span class="keyword">do</span></span><br><span class="line">      <span class="variable">@behaviour</span> <span class="title class_">DemoBehaviour</span></span><br><span class="line">      <span class="function"><span class="keyword">def</span> <span class="title">demo</span></span>(x, y) <span class="keyword">do</span></span><br><span class="line">        <span class="title class_">Logger</span>.debug(<span class="string">&quot;default in DemoBehaviour&quot;</span>)</span><br><span class="line">        x + y</span><br><span class="line">      <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">      defoverridable <span class="title class_">DemoBehaviour</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">defmodule</span> <span class="title">Demo</span></span> <span class="keyword">do</span></span><br><span class="line">  <span class="keyword">require</span> <span class="title class_">Logger</span></span><br><span class="line">  <span class="keyword">use</span> <span class="title class_">DemoUsing</span></span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">demo</span></span>(x, y) <span class="keyword">do</span></span><br><span class="line">    <span class="comment"># super(x, y)</span></span><br><span class="line">    <span class="title class_">Logger</span>.debug(<span class="string">&quot;override in DemoBehaviour&quot;</span>)</span><br><span class="line">    x * y</span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>

<p>测试</p>
<figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Demo</span>.demo(<span class="number">11</span>, <span class="number">22</span>)</span><br></pre></td></tr></table></figure>

<h3 id="动态生成常量"><a href="#动态生成常量" class="headerlink" title="动态生成常量"></a>动态生成常量</h3><p>模块编译完成以后，会打印 [“henry”, “john”]</p>
<figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">defmodule</span> <span class="title">DemoMacro</span></span> <span class="keyword">do</span></span><br><span class="line">  <span class="function"><span class="keyword">defmacro</span> <span class="title">add</span></span>(name) <span class="keyword">do</span></span><br><span class="line">    <span class="keyword">quote</span> <span class="keyword">do</span></span><br><span class="line">      <span class="variable">@names</span> <span class="keyword">unquote</span>(name)</span><br><span class="line">      <span class="symbol">:ok</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">defmodule</span> <span class="title">Demo</span></span> <span class="keyword">do</span></span><br><span class="line">  <span class="keyword">require</span> <span class="title class_">DemoMacro</span></span><br><span class="line">  <span class="keyword">import</span> <span class="title class_">DemoMacro</span></span><br><span class="line"></span><br><span class="line">  <span class="title class_">Module</span>.register_attribute(__MODULE__, <span class="symbol">:names</span>, <span class="symbol">accumulate:</span> <span class="literal">true</span>)</span><br><span class="line"></span><br><span class="line">  add <span class="string">&quot;john&quot;</span></span><br><span class="line">  add <span class="string">&quot;henry&quot;</span></span><br><span class="line"></span><br><span class="line">  <span class="title class_">IO</span>.inspect(<span class="variable">@names</span>)</span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>

<h3 id="修改属性"><a href="#修改属性" class="headerlink" title="修改属性"></a>修改属性</h3><figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">defmodule</span> <span class="title">DemoUsing</span></span> <span class="keyword">do</span></span><br><span class="line">  <span class="function"><span class="keyword">defmacro</span> <span class="title">__using__</span></span>(_) <span class="keyword">do</span></span><br><span class="line">    <span class="keyword">quote</span> <span class="keyword">do</span></span><br><span class="line">      <span class="title class_">Module</span>.register_attribute(__MODULE__, <span class="symbol">:xxx</span>, <span class="symbol">accumulate:</span> <span class="literal">true</span>)</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">defmacro</span> <span class="title">show</span></span>(name) <span class="keyword">do</span></span><br><span class="line">    <span class="keyword">quote</span> <span class="keyword">do</span></span><br><span class="line">      <span class="title class_">IO</span>.inspect(<span class="string">&quot;<span class="subst">#&#123;<span class="keyword">unquote</span>(name)&#125;</span> <span class="subst">#&#123;<span class="variable">@xxx</span>&#125;</span>&quot;</span>)</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">defmodule</span> <span class="title">Demo</span></span> <span class="keyword">do</span></span><br><span class="line">  <span class="keyword">use</span> <span class="title class_">DemoUsing</span></span><br><span class="line"></span><br><span class="line">  <span class="variable">@xxx</span> <span class="string">&quot;测试&quot;</span></span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">aaa</span></span>() <span class="keyword">do</span></span><br><span class="line">    <span class="title class_">DemoUsing</span>.show(<span class="string">&quot;123&quot;</span>)</span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>

<h3 id="编译期-hook"><a href="#编译期-hook" class="headerlink" title="编译期 hook"></a>编译期 hook</h3><figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">defmodule</span> <span class="title">DemoUsing</span></span> <span class="keyword">do</span></span><br><span class="line">  <span class="function"><span class="keyword">defmacro</span> <span class="title">__using__</span></span>(_) <span class="keyword">do</span></span><br><span class="line">    <span class="keyword">quote</span> <span class="keyword">do</span></span><br><span class="line">      <span class="variable">@before_compile</span> <span class="keyword">unquote</span>(__MODULE__)</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">defmacro</span> <span class="title">__before_compile__</span></span>(env) <span class="keyword">do</span></span><br><span class="line">    <span class="title class_">IO</span>.inspect(env)</span><br><span class="line">    <span class="literal">nil</span></span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">defmodule</span> <span class="title">Demo</span></span> <span class="keyword">do</span></span><br><span class="line">  <span class="keyword">use</span> <span class="title class_">DemoUsing</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>

<h3 id="模拟-test"><a href="#模拟-test" class="headerlink" title="模拟 test"></a>模拟 test</h3><figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">defmodule</span> <span class="title">Calculator</span></span> <span class="keyword">do</span></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">add</span></span>(a, b), <span class="symbol">do:</span> a + b</span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">subtract</span></span>(a, b), <span class="symbol">do:</span> a - b</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">defmodule</span> <span class="title">TestCase</span></span> <span class="keyword">do</span></span><br><span class="line">  <span class="function"><span class="keyword">defmacro</span> <span class="title">__using__</span></span>(_) <span class="keyword">do</span></span><br><span class="line">    <span class="keyword">quote</span> <span class="keyword">do</span></span><br><span class="line">      <span class="keyword">require</span> <span class="title class_">Logger</span></span><br><span class="line">      <span class="keyword">import</span> <span class="title class_">TestCase</span></span><br><span class="line">      <span class="title class_">Module</span>.register_attribute(__MODULE__, <span class="symbol">:tests</span>, <span class="symbol">accumulate:</span> <span class="literal">true</span>)</span><br><span class="line">      <span class="variable">@before_compile</span> <span class="keyword">unquote</span>(__MODULE__)</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">defmacro</span> <span class="title">__before_compile__</span></span>(_env) <span class="keyword">do</span></span><br><span class="line">    <span class="comment"># Inject a run function into the test case after all tests have been accumulated</span></span><br><span class="line">    <span class="keyword">quote</span> <span class="keyword">do</span></span><br><span class="line">      <span class="function"><span class="keyword">def</span> <span class="title">run</span></span> <span class="keyword">do</span></span><br><span class="line">        <span class="title class_">Enum</span>.each <span class="variable">@tests</span>, <span class="keyword">fn</span> test_name -&gt;</span><br><span class="line">          result = apply(__MODULE__, test_name, [])</span><br><span class="line">          state = <span class="keyword">if</span> result, <span class="symbol">do:</span> <span class="string">&quot;pass&quot;</span>, <span class="symbol">else:</span> <span class="string">&quot;fail&quot;</span></span><br><span class="line">          <span class="title class_">Logger</span>.debug(<span class="string">&quot;<span class="subst">#&#123;test_name&#125;</span> =&gt; <span class="subst">#&#123;state&#125;</span>&quot;</span>)</span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line">      <span class="keyword">end</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">defmacro</span> <span class="title">test</span></span>(description, <span class="symbol">do:</span> body) <span class="keyword">do</span></span><br><span class="line">    test_name = <span class="title class_">String</span>.to_atom(description)</span><br><span class="line">    <span class="keyword">quote</span> <span class="keyword">do</span></span><br><span class="line">      <span class="variable">@tests</span> <span class="keyword">unquote</span>(test_name)</span><br><span class="line">      <span class="function"><span class="keyword">def</span> <span class="title">unquote</span></span>(test_name)(), <span class="symbol">do:</span> <span class="keyword">unquote</span>(body)</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">defmodule</span> <span class="title">CalculatorTest</span></span> <span class="keyword">do</span></span><br><span class="line">  <span class="keyword">use</span> <span class="title class_">TestCase</span></span><br><span class="line">  <span class="keyword">import</span> <span class="title class_">Calculator</span></span><br><span class="line"></span><br><span class="line">  test <span class="string">&quot;add 1, 2 should return 3&quot;</span> <span class="keyword">do</span></span><br><span class="line">    add(<span class="number">1</span>, <span class="number">2</span>) == <span class="number">3</span></span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">  test <span class="string">&quot;subtract 5, 2 should not return 4&quot;</span> <span class="keyword">do</span></span><br><span class="line">    subtract(<span class="number">5</span>, <span class="number">2</span>) == <span class="number">4</span></span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="title class_">CalculatorTest</span>.run</span><br></pre></td></tr></table></figure>

      
    </div>

  </div>

  <div class="article-footer">
    <div class="article-meta pull-left">

    

    
    

    <span class="post-tags">
      <i class="icon-tags"></i>
        <a href="/tags/elixir/">elixir</a>
    </span>
    

    </div>

    
  </div>
</article>



  <article>

  
    
    <h3 class="article-title"><a href="/2025/12/06/erlang-deps/"><span>erlang 之添加依赖</span></a></h3>
    
  

  <div class="article-top-meta">
    <span class="posted-on">
      <a href="/2025/12/06/erlang-deps/" rel="bookmark">
        <time class="entry-date published" datetime="2025-12-06T02:06:30.000Z">
          2025-12-06
        </time>
      </a>
    </span>
  </div>


  

  <div class="article-content">
    <div class="entry">
      
        <h2 id="说明"><a href="#说明" class="headerlink" title="说明"></a>说明</h2><p>不能加载 elixir 的库</p>
<h2 id="用法"><a href="#用法" class="headerlink" title="用法"></a>用法</h2><h3 id="远程依赖"><a href="#远程依赖" class="headerlink" title="远程依赖"></a>远程依赖</h3><p>hex.pm</p>
<figure class="highlight erlang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123;deps,[</span><br><span class="line">  &#123;jsx, <span class="string">&quot;3.1.0&quot;</span>&#125;</span><br><span class="line">]&#125;.</span><br></pre></td></tr></table></figure>

<p>分支</p>
<figure class="highlight erlang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123;deps, [</span><br><span class="line">  &#123;ets_cache, <span class="string">&quot;.*&quot;</span>, &#123;git, <span class="string">&quot;https://github.com/roowe/ets_cache&quot;</span>, &#123;branch, <span class="string">&quot;master&quot;</span>&#125;&#125;&#125;</span><br><span class="line">]&#125;.</span><br></pre></td></tr></table></figure>

<p>tag</p>
<figure class="highlight erlang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123;deps, [</span><br><span class="line">  &#123;erlbus, &#123;git, <span class="string">&quot;https://github.com/cabol/erlbus&quot;</span>, &#123;tag, <span class="string">&quot;v0.3.0&quot;</span>&#125;&#125;&#125;</span><br><span class="line">]&#125;.</span><br></pre></td></tr></table></figure>

<h3 id="本地依赖"><a href="#本地依赖" class="headerlink" title="本地依赖"></a>本地依赖</h3><p>目录层级</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">.</span><br><span class="line">├── demo</span><br><span class="line">│   ├── rebar.config</span><br><span class="line">│   └── src</span><br><span class="line">└── demo_lib</span><br><span class="line">    ├── rebar.config</span><br><span class="line">    └── src</span><br></pre></td></tr></table></figure>

<figure class="highlight erlang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&#123;deps, [</span><br><span class="line">    &#123;demo_lib, &#123;path, <span class="string">&quot;../demo_lib&quot;</span>&#125;&#125;</span><br><span class="line">]&#125;.</span><br><span class="line"></span><br><span class="line">&#123;plugins, [</span><br><span class="line">    rebar3_path_deps</span><br><span class="line">]&#125;.</span><br></pre></td></tr></table></figure>

      
    </div>

  </div>

  <div class="article-footer">
    <div class="article-meta pull-left">

    

    
    

    <span class="post-tags">
      <i class="icon-tags"></i>
        <a href="/tags/erlang/">erlang</a>
    </span>
    

    </div>

    
  </div>
</article>



  <article>

  
    
    <h3 class="article-title"><a href="/2025/12/06/elixir-deps/"><span>elixir 之添加依赖</span></a></h3>
    
  

  <div class="article-top-meta">
    <span class="posted-on">
      <a href="/2025/12/06/elixir-deps/" rel="bookmark">
        <time class="entry-date published" datetime="2025-12-06T02:06:26.000Z">
          2025-12-06
        </time>
      </a>
    </span>
  </div>


  

  <div class="article-content">
    <div class="entry">
      
        <h2 id="说明"><a href="#说明" class="headerlink" title="说明"></a>说明</h2><p>可以加载 erlang 的库</p>
<h2 id="搜索"><a href="#搜索" class="headerlink" title="搜索"></a>搜索</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mix hex.search --package nebulex</span><br></pre></td></tr></table></figure>

<h2 id="用法"><a href="#用法" class="headerlink" title="用法"></a>用法</h2><p>加载本地库</p>
<figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;<span class="symbol">:xxx</span>, <span class="symbol">path:</span> <span class="string">&quot;../xxx&quot;</span>&#125;</span><br></pre></td></tr></table></figure>

<p>指定分支</p>
<figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;<span class="symbol">:bumblebee</span>, <span class="symbol">github:</span> <span class="string">&quot;elixir-nx/bumblebee&quot;</span>, <span class="symbol">branch:</span> <span class="string">&quot;main&quot;</span>&#125;</span><br></pre></td></tr></table></figure>

<p>强制使用某个版本</p>
<figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;<span class="symbol">:bumblebee</span>, <span class="symbol">github:</span> <span class="string">&quot;elixir-nx/bumblebee&quot;</span>, <span class="symbol">branch:</span> <span class="string">&quot;main&quot;</span>, <span class="symbol">override:</span> <span class="literal">true</span>&#125;</span><br></pre></td></tr></table></figure>

<p>指定环境下加载</p>
<figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;<span class="symbol">:exla</span>, <span class="string">&quot;~&gt; 0.7&quot;</span>, <span class="symbol">only:</span> [<span class="symbol">:dev</span>, <span class="symbol">:test</span>]&#125;</span><br></pre></td></tr></table></figure>

<p>运行时并不加载</p>
<figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;<span class="symbol">:ex_doc</span>, <span class="string">&quot;~&gt; 0.29&quot;</span>, <span class="symbol">only:</span> <span class="symbol">:dev</span>, <span class="symbol">runtime:</span> <span class="literal">false</span>&#125;</span><br></pre></td></tr></table></figure>

      
    </div>

  </div>

  <div class="article-footer">
    <div class="article-meta pull-left">

    

    
    

    <span class="post-tags">
      <i class="icon-tags"></i>
        <a href="/tags/elixir/">elixir</a>
    </span>
    

    </div>

    
  </div>
</article>



  <article>

  
    
    <h3 class="article-title"><a href="/2025/12/05/elixir-project-types/"><span>elixir 项目类型</span></a></h3>
    
  

  <div class="article-top-meta">
    <span class="posted-on">
      <a href="/2025/12/05/elixir-project-types/" rel="bookmark">
        <time class="entry-date published" datetime="2025-12-04T23:57:13.000Z">
          2025-12-05
        </time>
      </a>
    </span>
  </div>


  

  <div class="article-content">
    <div class="entry">
      
        <h2 id="app"><a href="#app" class="headerlink" title="app"></a>app</h2><p>带 Application</p>
<h3 id="例子"><a href="#例子" class="headerlink" title="例子"></a>例子</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mix new demo --sup</span><br></pre></td></tr></table></figure>

<p>验证</p>
<figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Application</span>.started_applications</span><br></pre></td></tr></table></figure>

<h2 id="escript"><a href="#escript" class="headerlink" title="escript"></a>escript</h2><p>可执行脚本，需要本机安装 elixir</p>
<h3 id="例子-1"><a href="#例子-1" class="headerlink" title="例子"></a>例子</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mix new demo</span><br></pre></td></tr></table></figure>

<p>mix.exs</p>
<figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">project</span></span> <span class="keyword">do</span></span><br><span class="line">  [</span><br><span class="line">    ...</span><br><span class="line">    <span class="symbol">escript:</span> escript()</span><br><span class="line">  ]</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">defp</span> <span class="title">escript</span></span> <span class="keyword">do</span></span><br><span class="line">  [</span><br><span class="line">    <span class="symbol">main_module:</span> <span class="title class_">DemoApp</span>,</span><br><span class="line">    <span class="symbol">path:</span> <span class="string">&quot;_build/escripts/aaa&quot;</span>,</span><br><span class="line">  ]</span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>

<figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">defmodule</span> <span class="title">DemoApp</span></span> <span class="keyword">do</span></span><br><span class="line">  <span class="keyword">require</span> <span class="title class_">Logger</span></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">main</span></span>(args) <span class="keyword">do</span></span><br><span class="line">    <span class="title class_">Logger</span>.debug(<span class="string">&quot;args <span class="subst">#&#123;inspect(args)&#125;</span>&quot;</span>)</span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>

<p>发布</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mix escript.build</span><br></pre></td></tr></table></figure>

<h2 id="lib"><a href="#lib" class="headerlink" title="lib"></a>lib</h2><p>默认的项目类型就是 lib</p>
<h3 id="例子-2"><a href="#例子-2" class="headerlink" title="例子"></a>例子</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mix new demo</span><br></pre></td></tr></table></figure>

<h2 id="umbrella"><a href="#umbrella" class="headerlink" title="umbrella"></a>umbrella</h2><p>项目大了以后，db 和 web 等希望独立出来</p>
<h3 id="用法"><a href="#用法" class="headerlink" title="用法"></a>用法</h3><h4 id="创建"><a href="#创建" class="headerlink" title="创建"></a>创建</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">mix new umbrella_demo --umbrella</span><br><span class="line"><span class="built_in">cd</span> umbrella_demo/apps</span><br><span class="line"></span><br><span class="line"><span class="comment"># 普通子项目</span></span><br><span class="line">mix new demo1</span><br><span class="line"></span><br><span class="line"><span class="comment"># phoenix 子项目</span></span><br><span class="line">mix phx.new.web demo_web</span><br><span class="line"><span class="comment"># ecto 子项目</span></span><br><span class="line">mix phx.new.ecto demo_ecto</span><br></pre></td></tr></table></figure>

<h4 id="依赖"><a href="#依赖" class="headerlink" title="依赖"></a>依赖</h4><p>共享依赖，放在顶层的 mix.exs</p>
<p>子项目依赖，放在子项目里面的 mix.exs</p>
<h4 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h4><p>默认只读取最外层配置，建议拆分</p>
<p>在顶层 config 目录里面拆，具体见配置分离文档</p>
<h4 id="app-自启动"><a href="#app-自启动" class="headerlink" title="app 自启动"></a>app 自启动</h4><p>需要自动启动的 application, 在子项目的 mix.exs 里面修改</p>

      
    </div>

  </div>

  <div class="article-footer">
    <div class="article-meta pull-left">

    

    
    

    <span class="post-tags">
      <i class="icon-tags"></i>
        <a href="/tags/elixir/">elixir</a>
    </span>
    

    </div>

    
  </div>
</article>



  <article>

  
    
    <h3 class="article-title"><a href="/2025/12/04/elixir-config-split/"><span>elixir 之配置文件拆分</span></a></h3>
    
  

  <div class="article-top-meta">
    <span class="posted-on">
      <a href="/2025/12/04/elixir-config-split/" rel="bookmark">
        <time class="entry-date published" datetime="2025-12-04T00:21:21.000Z">
          2025-12-04
        </time>
      </a>
    </span>
  </div>


  

  <div class="article-content">
    <div class="entry">
      
        <h2 id="说明"><a href="#说明" class="headerlink" title="说明"></a>说明</h2><p>配置太多，需要拆分</p>
<h2 id="目录结构"><a href="#目录结构" class="headerlink" title="目录结构"></a>目录结构</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">├── config.exs</span><br><span class="line">├── dev</span><br><span class="line">│   ├── api.exs</span><br><span class="line">│   └── bot.exs</span><br><span class="line">├── prod</span><br><span class="line">│   └── api.exs</span><br><span class="line">├── runtime</span><br><span class="line">│   └── api.exs</span><br><span class="line">└── <span class="built_in">test</span></span><br><span class="line">    └── api.exs</span><br></pre></td></tr></table></figure>

<p>config.exs</p>
<figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># import_config &quot;#&#123;config_env()&#125;.exs&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># umbrella 项目的话，在顶层 config 目录内拆分</span></span><br><span class="line"><span class="keyword">for</span> config &lt;- <span class="string">&quot;<span class="subst">#&#123;config_env()&#125;</span>/*.exs&quot;</span> |&gt; <span class="title class_">Path</span>.expand(__DIR__) |&gt; <span class="title class_">Path</span>.wildcard() <span class="keyword">do</span></span><br><span class="line">  <span class="keyword">if</span> <span class="title class_">File</span>.exists?(config) <span class="keyword">do</span></span><br><span class="line">    import_config config</span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>

      
    </div>

  </div>

  <div class="article-footer">
    <div class="article-meta pull-left">

    

    
    

    <span class="post-tags">
      <i class="icon-tags"></i>
        <a href="/tags/elixir/">elixir</a>
    </span>
    

    </div>

    
  </div>
</article>



  <article>

  
    
    <h3 class="article-title"><a href="/2025/12/03/elixir-config/"><span>elixir 之配置文件</span></a></h3>
    
  

  <div class="article-top-meta">
    <span class="posted-on">
      <a href="/2025/12/03/elixir-config/" rel="bookmark">
        <time class="entry-date published" datetime="2025-12-03T00:08:34.000Z">
          2025-12-03
        </time>
      </a>
    </span>
  </div>


  

  <div class="article-content">
    <div class="entry">
      
        <h2 id="说明"><a href="#说明" class="headerlink" title="说明"></a>说明</h2><ol>
<li>runtime 为运行时会调用的配置文件, 其它为编译期调用的配置</li>
<li>固定的配置写在 dev&#x2F;prod 等里面</li>
<li>动态配置，写在 runtime 里面，如果 runtime 里面没有，则从 dev&#x2F;prod 里面去取</li>
</ol>
<h2 id="例子"><a href="#例子" class="headerlink" title="例子"></a>例子</h2><h3 id="目录结构"><a href="#目录结构" class="headerlink" title="目录结构"></a>目录结构</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">lib</span><br><span class="line">└── demo.exs</span><br><span class="line">config</span><br><span class="line">├── config.exs</span><br><span class="line">├── dev.exs</span><br><span class="line">├── test.exs</span><br><span class="line">├── prod.exs</span><br><span class="line">└── runtime.exs</span><br></pre></td></tr></table></figure>

<h3 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h3><p>config.exs</p>
<figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">Config</span></span><br><span class="line"></span><br><span class="line">config <span class="symbol">:demo</span>, <span class="symbol">mode:</span> config_env()</span><br><span class="line">import_config <span class="string">&quot;<span class="subst">#&#123;config_env()&#125;</span>.exs&quot;</span></span><br></pre></td></tr></table></figure>

<p>dev.exs</p>
<figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">Config</span></span><br><span class="line"></span><br><span class="line">config <span class="symbol">:demo</span>,</span><br><span class="line">  <span class="symbol">aaa:</span> <span class="string">&quot;aaa in dev&quot;</span>,</span><br><span class="line">  <span class="symbol">bbb:</span> <span class="string">&quot;bbb in dev&quot;</span></span><br><span class="line"></span><br><span class="line">config <span class="symbol">:demo</span>, <span class="title class_">MyModule</span>,</span><br><span class="line">  <span class="symbol">ccc:</span> <span class="string">&quot;ccc in dev&quot;</span>,</span><br><span class="line">  <span class="symbol">ddd:</span> <span class="string">&quot;ddd in dev&quot;</span></span><br></pre></td></tr></table></figure>

<p>test.exs</p>
<figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">Config</span></span><br><span class="line"></span><br><span class="line">config <span class="symbol">:demo</span>,</span><br><span class="line">  <span class="symbol">aaa:</span> <span class="string">&quot;aaa in test&quot;</span>,</span><br><span class="line">  <span class="symbol">bbb:</span> <span class="string">&quot;bbb in test&quot;</span></span><br><span class="line"></span><br><span class="line">config <span class="symbol">:demo</span>, <span class="title class_">MyModule</span>,</span><br><span class="line">  <span class="symbol">ccc:</span> <span class="string">&quot;ccc in test&quot;</span>,</span><br><span class="line">  <span class="symbol">ddd:</span> <span class="string">&quot;ddd in test&quot;</span></span><br></pre></td></tr></table></figure>

<p>prod.exs</p>
<figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">Config</span></span><br><span class="line"></span><br><span class="line">config <span class="symbol">:demo</span>,</span><br><span class="line">  <span class="symbol">aaa:</span> <span class="string">&quot;aaa in prod&quot;</span>,</span><br><span class="line">  <span class="symbol">bbb:</span> <span class="string">&quot;bbb in prod&quot;</span></span><br><span class="line"></span><br><span class="line">config <span class="symbol">:demo</span>, <span class="title class_">MyModule</span>,</span><br><span class="line">  <span class="symbol">ccc:</span> <span class="string">&quot;ccc in prod&quot;</span>,</span><br><span class="line">  <span class="symbol">ddd:</span> <span class="string">&quot;ddd in prod&quot;</span></span><br></pre></td></tr></table></figure>

<p>runtime.exs</p>
<figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">Config</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 这个只能用于配置文件，代码内不能使用这个方式动态处理代码</span></span><br><span class="line"><span class="keyword">if</span> config_env() == <span class="symbol">:prod</span> <span class="keyword">do</span></span><br><span class="line">  config <span class="symbol">:demo</span>,</span><br><span class="line">    <span class="symbol">aaa:</span> <span class="title class_">System</span>.get_env(<span class="string">&quot;AAA&quot;</span>) || <span class="string">&quot;aaa in runtime&quot;</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>

<h3 id="测试"><a href="#测试" class="headerlink" title="测试"></a>测试</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">MIX_ENV=prod iex -S mix</span><br></pre></td></tr></table></figure>

<figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Application</span>.fetch_env!(<span class="symbol">:demo</span>, <span class="symbol">:aaa</span>)</span><br><span class="line"><span class="title class_">Application</span>.get_env(<span class="symbol">:demo</span>, <span class="symbol">:bbb</span>)</span><br><span class="line"></span><br><span class="line">[<span class="symbol">ccc:</span> ccc_value, <span class="symbol">ddd:</span> ddd_value] = <span class="title class_">Application</span>.get_env(<span class="symbol">:demo</span>, <span class="title class_">MyModule</span>)</span><br></pre></td></tr></table></figure>

<h3 id="备注"><a href="#备注" class="headerlink" title="备注"></a>备注</h3><p>如果需要在运行的时候获取当前模式</p>
<figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> <span class="title class_">Application</span>.get_env(<span class="symbol">:demo</span>, <span class="symbol">:mode</span>) === <span class="symbol">:prod</span> <span class="keyword">do</span></span><br><span class="line">  xxxx</span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>

      
    </div>

  </div>

  <div class="article-footer">
    <div class="article-meta pull-left">

    

    
    

    <span class="post-tags">
      <i class="icon-tags"></i>
        <a href="/tags/elixir/">elixir</a>
    </span>
    

    </div>

    
  </div>
</article>



  <article>

  
    
    <h3 class="article-title"><a href="/2025/12/02/elixir-cond-panduan/"><span>elixir 之 cond 判断</span></a></h3>
    
  

  <div class="article-top-meta">
    <span class="posted-on">
      <a href="/2025/12/02/elixir-cond-panduan/" rel="bookmark">
        <time class="entry-date published" datetime="2025-12-02T07:23:10.000Z">
          2025-12-02
        </time>
      </a>
    </span>
  </div>


  

  <div class="article-content">
    <div class="entry">
      
        <h2 id="说明"><a href="#说明" class="headerlink" title="说明"></a>说明</h2><p>都不支持多 else</p>
<p>匹配条件可以用函数</p>
<h2 id="用法"><a href="#用法" class="headerlink" title="用法"></a>用法</h2><h3 id="cond"><a href="#cond" class="headerlink" title="cond"></a>cond</h3><figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">info1 = <span class="string">&quot;&quot;</span></span><br><span class="line">info2 = <span class="string">&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">cond</span> <span class="keyword">do</span></span><br><span class="line">  <span class="title class_">String</span>.length(info1) !== <span class="number">0</span> -&gt;</span><br><span class="line">    <span class="string">&quot;info1 not 0&quot;</span></span><br><span class="line"></span><br><span class="line">  <span class="title class_">String</span>.length(info2) !== <span class="number">0</span> -&gt;</span><br><span class="line">    <span class="string">&quot;info2 not 0&quot;</span></span><br><span class="line"></span><br><span class="line">  <span class="title class_">String</span>.length(info1) === <span class="number">0</span> &amp;&amp; <span class="title class_">String</span>.length(info2) === <span class="number">0</span> -&gt;</span><br><span class="line">    <span class="string">&quot;len are 0&quot;</span></span><br><span class="line"></span><br><span class="line">  <span class="literal">true</span> -&gt;</span><br><span class="line">    <span class="string">&quot;default&quot;</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>

<h3 id="if"><a href="#if" class="headerlink" title="if"></a>if</h3><figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> <span class="title class_">String</span>.valid?(<span class="string">&quot;aaa&quot;</span>) &amp;&amp; <span class="title class_">String</span>.valid?(<span class="string">&quot;bbb&quot;</span>) <span class="keyword">do</span></span><br><span class="line">  <span class="string">&quot;Valid string!&quot;</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">  <span class="string">&quot;Invalid string.&quot;</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>

      
    </div>

  </div>

  <div class="article-footer">
    <div class="article-meta pull-left">

    

    
    

    <span class="post-tags">
      <i class="icon-tags"></i>
        <a href="/tags/elixir/">elixir</a>
    </span>
    

    </div>

    
  </div>
</article>



  <article>

  
    
    <h3 class="article-title"><a href="/2025/12/02/elixir-match-panduan/"><span>elixir 之 match 判断</span></a></h3>
    
  

  <div class="article-top-meta">
    <span class="posted-on">
      <a href="/2025/12/02/elixir-match-panduan/" rel="bookmark">
        <time class="entry-date published" datetime="2025-12-02T07:23:05.000Z">
          2025-12-02
        </time>
      </a>
    </span>
  </div>


  

  <div class="article-content">
    <div class="entry">
      
        <h2 id="说明"><a href="#说明" class="headerlink" title="说明"></a>说明</h2><p>都不支持多 else</p>
<h2 id="用法"><a href="#用法" class="headerlink" title="用法"></a>用法</h2><h3 id="case"><a href="#case" class="headerlink" title="case"></a>case</h3><ul>
<li>待匹配变量必须先定义</li>
<li>匹配条件不可以用函数</li>
</ul>
<figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">require</span> <span class="title class_">Logger</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">case</span> xxx(<span class="string">&quot;aaa&quot;</span>) <span class="keyword">do</span></span><br><span class="line">  <span class="string">&quot;aaa&quot;</span> -&gt;</span><br><span class="line">    <span class="title class_">Logger</span>.debug(<span class="string">&quot;aaa&quot;</span>)</span><br><span class="line"></span><br><span class="line">  <span class="string">&quot;bbb&quot;</span> -&gt;</span><br><span class="line">    <span class="title class_">Logger</span>.debug(<span class="string">&quot;bbb&quot;</span>)</span><br><span class="line">  _ -&gt;</span><br><span class="line">    <span class="title class_">Logger</span>.debug(<span class="string">&quot;default&quot;</span>)</span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>

<h3 id="with"><a href="#with" class="headerlink" title="with"></a>with</h3><ul>
<li>链式匹配，所以待匹配变量无需定义</li>
<li>如果某个 step 失败，之前的还是会成功执行</li>
</ul>
<figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">defmodule</span> <span class="title">WithDemo</span></span> <span class="keyword">do</span></span><br><span class="line">  <span class="keyword">require</span> <span class="title class_">Logger</span></span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">demo</span></span> <span class="keyword">do</span></span><br><span class="line">    <span class="keyword">with</span> &#123;<span class="symbol">:ok</span>, result1&#125; &lt;- step1(),</span><br><span class="line">         &#123;<span class="symbol">:ok</span>, result2&#125; &lt;- step2(result1),</span><br><span class="line">         &#123;<span class="symbol">:ok</span>, result3&#125; &lt;- step3(result2) <span class="keyword">do</span></span><br><span class="line">      <span class="title class_">Logger</span>.debug(<span class="string">&quot;final result <span class="subst">#&#123;result1 + result2 + result3&#125;</span>&quot;</span>)</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">      &#123;<span class="symbol">:error</span>, _&#125; -&gt;</span><br><span class="line">        <span class="title class_">Logger</span>.debug(<span class="string">&quot;某些需要匹配的错误&quot;</span>)</span><br><span class="line"></span><br><span class="line">      _ -&gt;</span><br><span class="line">        <span class="title class_">Logger</span>.debug(<span class="string">&quot;都不匹配，到这里&quot;</span>)</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">step1</span></span>() <span class="keyword">do</span></span><br><span class="line">    <span class="title class_">Logger</span>.debug(<span class="string">&quot;in step1&quot;</span>)</span><br><span class="line">    &#123;<span class="symbol">:ok</span>, <span class="number">111</span>&#125;</span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">step2</span></span>(arg) <span class="keyword">do</span></span><br><span class="line">    <span class="title class_">Logger</span>.debug(<span class="string">&quot;in step2 <span class="subst">#&#123;inspect(arg)&#125;</span>&quot;</span>)</span><br><span class="line">    &#123;<span class="symbol">:ok</span>, <span class="number">222</span>&#125;</span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">step3</span></span>(arg) <span class="keyword">do</span></span><br><span class="line">    <span class="title class_">Logger</span>.debug(<span class="string">&quot;in step2 <span class="subst">#&#123;inspect(arg)&#125;</span>&quot;</span>)</span><br><span class="line">    &#123;<span class="symbol">:ok</span>, <span class="number">333</span>&#125;</span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>

      
    </div>

  </div>

  <div class="article-footer">
    <div class="article-meta pull-left">

    

    
    

    <span class="post-tags">
      <i class="icon-tags"></i>
        <a href="/tags/elixir/">elixir</a>
    </span>
    

    </div>

    
  </div>
</article>



  <article>

  
    
    <h3 class="article-title"><a href="/2025/12/01/elixir-node-visualize/"><span>elixir 之节点可视化</span></a></h3>
    
  

  <div class="article-top-meta">
    <span class="posted-on">
      <a href="/2025/12/01/elixir-node-visualize/" rel="bookmark">
        <time class="entry-date published" datetime="2025-12-01T00:18:10.000Z">
          2025-12-01
        </time>
      </a>
    </span>
  </div>


  

  <div class="article-content">
    <div class="entry">
      
        <p>Phoenix LiveDashboard，从 phoenix 独立出来了</p>
<h2 id="步骤"><a href="#步骤" class="headerlink" title="步骤"></a>步骤</h2><h3 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mix escript.install hex plds</span><br></pre></td></tr></table></figure>

<h3 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">iex --sname aaa@localhost --cookie 123456</span><br><span class="line">plds server --connect aaa@localhost --cookie 123456 --port 9000 --open</span><br></pre></td></tr></table></figure>

<p>注意右上角的节点，别选错了</p>

      
    </div>

  </div>

  <div class="article-footer">
    <div class="article-meta pull-left">

    

    
    

    <span class="post-tags">
      <i class="icon-tags"></i>
        <a href="/tags/elixir/">elixir</a>
    </span>
    

    </div>

    
  </div>
</article>



  <article>

  
    
    <h3 class="article-title"><a href="/2025/12/01/elixir-phoenix-deploy/"><span>elixir phoenix 应用原生发布</span></a></h3>
    
  

  <div class="article-top-meta">
    <span class="posted-on">
      <a href="/2025/12/01/elixir-phoenix-deploy/" rel="bookmark">
        <time class="entry-date published" datetime="2025-12-01T00:16:10.000Z">
          2025-12-01
        </time>
      </a>
    </span>
  </div>


  

  <div class="article-content">
    <div class="entry">
      
        <p><a target="_blank" rel="noopener" href="https://hexdocs.pm/phoenix/deployment.html">参考地址</a></p>
<h2 id="例子"><a href="#例子" class="headerlink" title="例子"></a>例子</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">mix deps.get --only prod</span><br><span class="line">MIX_ENV=prod mix compile</span><br><span class="line"></span><br><span class="line">MIX_ENV=prod mix assets.deploy</span><br><span class="line"><span class="comment"># MIX_ENV=prod mix ecto.migrate</span></span><br><span class="line">MIX_ENV=prod mix release</span><br><span class="line"><span class="built_in">export</span> SECRET_KEY_BASE=`mix phx.gen.secret` PHX_SERVER=<span class="literal">true</span> PHX_HOST=<span class="string">&quot;aaa.com&quot;</span> PORT=9876;</span><br><span class="line">_build/prod/rel/web_demo/bin/web_demo start</span><br></pre></td></tr></table></figure>

      
    </div>

  </div>

  <div class="article-footer">
    <div class="article-meta pull-left">

    

    
    

    <span class="post-tags">
      <i class="icon-tags"></i>
        <a href="/tags/elixir/">elixir</a>
    </span>
    

    </div>

    
  </div>
</article>




<nav class="pagination">
  
  
  <a href="/page/2/" class="pagination-next">下一页</a>
  
</nav>
    </main>

    <footer class="site-footer">
  <p class="site-info">
    Proudly powered by <a href="https://hexo.io/" target="_blank">Hexo</a> and
    Theme by <a href="https://github.com/CodeDaraW/Hacker" target="_blank">Hacker</a>
    </br>
    
    &copy; 2025 John Doe
    
  </p>
</footer>
    
    
  </div>
</div>
</body>
</html>