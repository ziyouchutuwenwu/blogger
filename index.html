<!DOCTYPE HTML>
<html>
<head>
  <meta charset="utf-8" />
  
  <title>独钓寒江雪</title>

  
  <meta name="author" content="John Doe" />
    

  <meta
    id="viewport"
    name="viewport"
    content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no, minimal-ui" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />

  

  <meta property="og:site_name" content="独钓寒江雪" />

  
  <meta property="og:image" content="/favicon.ico" />
  

  <link href="/favicon.ico" rel="icon" />
  <link
    rel="alternate"
    href="/atom.xml"
    title="独钓寒江雪"
    type="application/atom+xml" />
  <link rel="stylesheet" href="/css/style.css" media="screen" type="text/css" />

  <script
    async
    src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-9313450459437229"
    crossorigin="anonymous"></script>
<meta name="generator" content="Hexo 8.0.0"></head>


<body>
<div class="blog">
  <div class="content">

    <header>
  <div class="site-branding">
    <h1 class="site-title">
      <a href="/">独钓寒江雪</a>
    </h1>
    <p class="site-description"></p>
  </div>
  <nav class="site-navigation">
    <ul>
      
        <li><a href="/">首页</a></li>
      
        <li><a href="/archives">归档</a></li>
      
        <li><a href="/tags">标签</a></li>
      
        <li><a href="/about">关于</a></li>
      
    </ul>
  </nav>
</header>

    <main class="site-main posts-loop">
    
  <article>

  
    
    <h3 class="article-title"><a href="/2025/12/05/elixir-project-types/"><span>elixir 项目类型</span></a></h3>
    
  

  <div class="article-top-meta">
    <span class="posted-on">
      <a href="/2025/12/05/elixir-project-types/" rel="bookmark">
        <time class="entry-date published" datetime="2025-12-04T23:57:13.000Z">
          2025-12-05
        </time>
      </a>
    </span>
  </div>


  

  <div class="article-content">
    <div class="entry">
      
        <h2 id="app"><a href="#app" class="headerlink" title="app"></a>app</h2><p>带 Application</p>
<h3 id="例子"><a href="#例子" class="headerlink" title="例子"></a>例子</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mix new demo --sup</span><br></pre></td></tr></table></figure>

<p>验证</p>
<figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Application</span>.started_applications</span><br></pre></td></tr></table></figure>

<h2 id="escript"><a href="#escript" class="headerlink" title="escript"></a>escript</h2><p>可执行脚本，需要本机安装 elixir</p>
<h3 id="例子-1"><a href="#例子-1" class="headerlink" title="例子"></a>例子</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mix new demo</span><br></pre></td></tr></table></figure>

<p>mix.exs</p>
<figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">project</span></span> <span class="keyword">do</span></span><br><span class="line">  [</span><br><span class="line">    ...</span><br><span class="line">    <span class="symbol">escript:</span> escript()</span><br><span class="line">  ]</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">defp</span> <span class="title">escript</span></span> <span class="keyword">do</span></span><br><span class="line">  [</span><br><span class="line">    <span class="symbol">main_module:</span> <span class="title class_">DemoApp</span>,</span><br><span class="line">    <span class="symbol">path:</span> <span class="string">&quot;_build/escripts/aaa&quot;</span>,</span><br><span class="line">  ]</span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>

<figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">defmodule</span> <span class="title">DemoApp</span></span> <span class="keyword">do</span></span><br><span class="line">  <span class="keyword">require</span> <span class="title class_">Logger</span></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">main</span></span>(args) <span class="keyword">do</span></span><br><span class="line">    <span class="title class_">Logger</span>.debug(<span class="string">&quot;args <span class="subst">#&#123;inspect(args)&#125;</span>&quot;</span>)</span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>

<p>发布</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mix escript.build</span><br></pre></td></tr></table></figure>

<h2 id="lib"><a href="#lib" class="headerlink" title="lib"></a>lib</h2><p>默认的项目类型就是 lib</p>
<h3 id="例子-2"><a href="#例子-2" class="headerlink" title="例子"></a>例子</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mix new demo</span><br></pre></td></tr></table></figure>

<h2 id="umbrella"><a href="#umbrella" class="headerlink" title="umbrella"></a>umbrella</h2><p>项目大了以后，db 和 web 等希望独立出来</p>
<h3 id="用法"><a href="#用法" class="headerlink" title="用法"></a>用法</h3><h4 id="创建"><a href="#创建" class="headerlink" title="创建"></a>创建</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">mix new umbrella_demo --umbrella</span><br><span class="line"><span class="built_in">cd</span> umbrella_demo/apps</span><br><span class="line"></span><br><span class="line"><span class="comment"># 普通子项目</span></span><br><span class="line">mix new demo1</span><br><span class="line"></span><br><span class="line"><span class="comment"># phoenix 子项目</span></span><br><span class="line">mix phx.new.web demo_web</span><br><span class="line"><span class="comment"># ecto 子项目</span></span><br><span class="line">mix phx.new.ecto demo_ecto</span><br></pre></td></tr></table></figure>

<h4 id="依赖"><a href="#依赖" class="headerlink" title="依赖"></a>依赖</h4><p>共享依赖，放在顶层的 mix.exs</p>
<p>子项目依赖，放在子项目里面的 mix.exs</p>
<h4 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h4><p>默认只读取最外层配置，建议拆分</p>
<p>在顶层 config 目录里面拆，具体见配置分离文档</p>
<h4 id="app-自启动"><a href="#app-自启动" class="headerlink" title="app 自启动"></a>app 自启动</h4><p>需要自动启动的 application, 在子项目的 mix.exs 里面修改</p>

      
    </div>

  </div>

  <div class="article-footer">
    <div class="article-meta pull-left">

    

    
    

    <span class="post-tags">
      <i class="icon-tags"></i>
        <a href="/tags/elixir/">elixir</a>
    </span>
    

    </div>

    
  </div>
</article>



  <article>

  
    
    <h3 class="article-title"><a href="/2025/12/04/elixir-config-split/"><span>elixir 之配置文件拆分</span></a></h3>
    
  

  <div class="article-top-meta">
    <span class="posted-on">
      <a href="/2025/12/04/elixir-config-split/" rel="bookmark">
        <time class="entry-date published" datetime="2025-12-04T00:21:21.000Z">
          2025-12-04
        </time>
      </a>
    </span>
  </div>


  

  <div class="article-content">
    <div class="entry">
      
        <h2 id="说明"><a href="#说明" class="headerlink" title="说明"></a>说明</h2><p>配置太多，需要拆分</p>
<h2 id="目录结构"><a href="#目录结构" class="headerlink" title="目录结构"></a>目录结构</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">├── config.exs</span><br><span class="line">├── dev</span><br><span class="line">│   ├── api.exs</span><br><span class="line">│   └── bot.exs</span><br><span class="line">├── prod</span><br><span class="line">│   └── api.exs</span><br><span class="line">├── runtime</span><br><span class="line">│   └── api.exs</span><br><span class="line">└── <span class="built_in">test</span></span><br><span class="line">    └── api.exs</span><br></pre></td></tr></table></figure>

<p>config.exs</p>
<figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># import_config &quot;#&#123;config_env()&#125;.exs&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># umbrella 项目的话，在顶层 config 目录内拆分</span></span><br><span class="line"><span class="keyword">for</span> config &lt;- <span class="string">&quot;<span class="subst">#&#123;config_env()&#125;</span>/*.exs&quot;</span> |&gt; <span class="title class_">Path</span>.expand(__DIR__) |&gt; <span class="title class_">Path</span>.wildcard() <span class="keyword">do</span></span><br><span class="line">  <span class="keyword">if</span> <span class="title class_">File</span>.exists?(config) <span class="keyword">do</span></span><br><span class="line">    import_config config</span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>

      
    </div>

  </div>

  <div class="article-footer">
    <div class="article-meta pull-left">

    

    
    

    <span class="post-tags">
      <i class="icon-tags"></i>
        <a href="/tags/elixir/">elixir</a>
    </span>
    

    </div>

    
  </div>
</article>



  <article>

  
    
    <h3 class="article-title"><a href="/2025/12/03/elixir-config/"><span>elixir 之配置文件</span></a></h3>
    
  

  <div class="article-top-meta">
    <span class="posted-on">
      <a href="/2025/12/03/elixir-config/" rel="bookmark">
        <time class="entry-date published" datetime="2025-12-03T00:08:34.000Z">
          2025-12-03
        </time>
      </a>
    </span>
  </div>


  

  <div class="article-content">
    <div class="entry">
      
        <h2 id="说明"><a href="#说明" class="headerlink" title="说明"></a>说明</h2><ol>
<li>runtime 为运行时会调用的配置文件, 其它为编译期调用的配置</li>
<li>固定的配置写在 dev&#x2F;prod 等里面</li>
<li>动态配置，写在 runtime 里面，如果 runtime 里面没有，则从 dev&#x2F;prod 里面去取</li>
</ol>
<h2 id="例子"><a href="#例子" class="headerlink" title="例子"></a>例子</h2><h3 id="目录结构"><a href="#目录结构" class="headerlink" title="目录结构"></a>目录结构</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">lib</span><br><span class="line">└── demo.exs</span><br><span class="line">config</span><br><span class="line">├── config.exs</span><br><span class="line">├── dev.exs</span><br><span class="line">├── test.exs</span><br><span class="line">├── prod.exs</span><br><span class="line">└── runtime.exs</span><br></pre></td></tr></table></figure>

<h3 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h3><p>config.exs</p>
<figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">Config</span></span><br><span class="line"></span><br><span class="line">config <span class="symbol">:demo</span>, <span class="symbol">mode:</span> config_env()</span><br><span class="line">import_config <span class="string">&quot;<span class="subst">#&#123;config_env()&#125;</span>.exs&quot;</span></span><br></pre></td></tr></table></figure>

<p>dev.exs</p>
<figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">Config</span></span><br><span class="line"></span><br><span class="line">config <span class="symbol">:demo</span>,</span><br><span class="line">  <span class="symbol">aaa:</span> <span class="string">&quot;aaa in dev&quot;</span>,</span><br><span class="line">  <span class="symbol">bbb:</span> <span class="string">&quot;bbb in dev&quot;</span></span><br><span class="line"></span><br><span class="line">config <span class="symbol">:demo</span>, <span class="title class_">MyModule</span>,</span><br><span class="line">  <span class="symbol">ccc:</span> <span class="string">&quot;ccc in dev&quot;</span>,</span><br><span class="line">  <span class="symbol">ddd:</span> <span class="string">&quot;ddd in dev&quot;</span></span><br></pre></td></tr></table></figure>

<p>test.exs</p>
<figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">Config</span></span><br><span class="line"></span><br><span class="line">config <span class="symbol">:demo</span>,</span><br><span class="line">  <span class="symbol">aaa:</span> <span class="string">&quot;aaa in test&quot;</span>,</span><br><span class="line">  <span class="symbol">bbb:</span> <span class="string">&quot;bbb in test&quot;</span></span><br><span class="line"></span><br><span class="line">config <span class="symbol">:demo</span>, <span class="title class_">MyModule</span>,</span><br><span class="line">  <span class="symbol">ccc:</span> <span class="string">&quot;ccc in test&quot;</span>,</span><br><span class="line">  <span class="symbol">ddd:</span> <span class="string">&quot;ddd in test&quot;</span></span><br></pre></td></tr></table></figure>

<p>prod.exs</p>
<figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">Config</span></span><br><span class="line"></span><br><span class="line">config <span class="symbol">:demo</span>,</span><br><span class="line">  <span class="symbol">aaa:</span> <span class="string">&quot;aaa in prod&quot;</span>,</span><br><span class="line">  <span class="symbol">bbb:</span> <span class="string">&quot;bbb in prod&quot;</span></span><br><span class="line"></span><br><span class="line">config <span class="symbol">:demo</span>, <span class="title class_">MyModule</span>,</span><br><span class="line">  <span class="symbol">ccc:</span> <span class="string">&quot;ccc in prod&quot;</span>,</span><br><span class="line">  <span class="symbol">ddd:</span> <span class="string">&quot;ddd in prod&quot;</span></span><br></pre></td></tr></table></figure>

<p>runtime.exs</p>
<figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">Config</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 这个只能用于配置文件，代码内不能使用这个方式动态处理代码</span></span><br><span class="line"><span class="keyword">if</span> config_env() == <span class="symbol">:prod</span> <span class="keyword">do</span></span><br><span class="line">  config <span class="symbol">:demo</span>,</span><br><span class="line">    <span class="symbol">aaa:</span> <span class="title class_">System</span>.get_env(<span class="string">&quot;AAA&quot;</span>) || <span class="string">&quot;aaa in runtime&quot;</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>

<h3 id="测试"><a href="#测试" class="headerlink" title="测试"></a>测试</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">MIX_ENV=prod iex -S mix</span><br></pre></td></tr></table></figure>

<figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Application</span>.fetch_env!(<span class="symbol">:demo</span>, <span class="symbol">:aaa</span>)</span><br><span class="line"><span class="title class_">Application</span>.get_env(<span class="symbol">:demo</span>, <span class="symbol">:bbb</span>)</span><br><span class="line"></span><br><span class="line">[<span class="symbol">ccc:</span> ccc_value, <span class="symbol">ddd:</span> ddd_value] = <span class="title class_">Application</span>.get_env(<span class="symbol">:demo</span>, <span class="title class_">MyModule</span>)</span><br></pre></td></tr></table></figure>

<h3 id="备注"><a href="#备注" class="headerlink" title="备注"></a>备注</h3><p>如果需要在运行的时候获取当前模式</p>
<figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> <span class="title class_">Application</span>.get_env(<span class="symbol">:demo</span>, <span class="symbol">:mode</span>) === <span class="symbol">:prod</span> <span class="keyword">do</span></span><br><span class="line">  xxxx</span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>

      
    </div>

  </div>

  <div class="article-footer">
    <div class="article-meta pull-left">

    

    
    

    <span class="post-tags">
      <i class="icon-tags"></i>
        <a href="/tags/elixir/">elixir</a>
    </span>
    

    </div>

    
  </div>
</article>



  <article>

  
    
    <h3 class="article-title"><a href="/2025/12/02/elixir-cond-panduan/"><span>elixir 之 cond 判断</span></a></h3>
    
  

  <div class="article-top-meta">
    <span class="posted-on">
      <a href="/2025/12/02/elixir-cond-panduan/" rel="bookmark">
        <time class="entry-date published" datetime="2025-12-02T07:23:10.000Z">
          2025-12-02
        </time>
      </a>
    </span>
  </div>


  

  <div class="article-content">
    <div class="entry">
      
        <h2 id="说明"><a href="#说明" class="headerlink" title="说明"></a>说明</h2><p>都不支持多 else</p>
<p>匹配条件可以用函数</p>
<h2 id="用法"><a href="#用法" class="headerlink" title="用法"></a>用法</h2><h3 id="cond"><a href="#cond" class="headerlink" title="cond"></a>cond</h3><figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">info1 = <span class="string">&quot;&quot;</span></span><br><span class="line">info2 = <span class="string">&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">cond</span> <span class="keyword">do</span></span><br><span class="line">  <span class="title class_">String</span>.length(info1) !== <span class="number">0</span> -&gt;</span><br><span class="line">    <span class="string">&quot;info1 not 0&quot;</span></span><br><span class="line"></span><br><span class="line">  <span class="title class_">String</span>.length(info2) !== <span class="number">0</span> -&gt;</span><br><span class="line">    <span class="string">&quot;info2 not 0&quot;</span></span><br><span class="line"></span><br><span class="line">  <span class="title class_">String</span>.length(info1) === <span class="number">0</span> &amp;&amp; <span class="title class_">String</span>.length(info2) === <span class="number">0</span> -&gt;</span><br><span class="line">    <span class="string">&quot;len are 0&quot;</span></span><br><span class="line"></span><br><span class="line">  <span class="literal">true</span> -&gt;</span><br><span class="line">    <span class="string">&quot;default&quot;</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>

<h3 id="if"><a href="#if" class="headerlink" title="if"></a>if</h3><figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> <span class="title class_">String</span>.valid?(<span class="string">&quot;aaa&quot;</span>) &amp;&amp; <span class="title class_">String</span>.valid?(<span class="string">&quot;bbb&quot;</span>) <span class="keyword">do</span></span><br><span class="line">  <span class="string">&quot;Valid string!&quot;</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">  <span class="string">&quot;Invalid string.&quot;</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>

      
    </div>

  </div>

  <div class="article-footer">
    <div class="article-meta pull-left">

    

    
    

    <span class="post-tags">
      <i class="icon-tags"></i>
        <a href="/tags/elixir/">elixir</a>
    </span>
    

    </div>

    
  </div>
</article>



  <article>

  
    
    <h3 class="article-title"><a href="/2025/12/02/elixir-match-panduan/"><span>elixir 之 match 判断</span></a></h3>
    
  

  <div class="article-top-meta">
    <span class="posted-on">
      <a href="/2025/12/02/elixir-match-panduan/" rel="bookmark">
        <time class="entry-date published" datetime="2025-12-02T07:23:05.000Z">
          2025-12-02
        </time>
      </a>
    </span>
  </div>


  

  <div class="article-content">
    <div class="entry">
      
        <h2 id="说明"><a href="#说明" class="headerlink" title="说明"></a>说明</h2><p>都不支持多 else</p>
<h2 id="用法"><a href="#用法" class="headerlink" title="用法"></a>用法</h2><h3 id="case"><a href="#case" class="headerlink" title="case"></a>case</h3><ul>
<li>待匹配变量必须先定义</li>
<li>匹配条件不可以用函数</li>
</ul>
<figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">require</span> <span class="title class_">Logger</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">case</span> xxx(<span class="string">&quot;aaa&quot;</span>) <span class="keyword">do</span></span><br><span class="line">  <span class="string">&quot;aaa&quot;</span> -&gt;</span><br><span class="line">    <span class="title class_">Logger</span>.debug(<span class="string">&quot;aaa&quot;</span>)</span><br><span class="line"></span><br><span class="line">  <span class="string">&quot;bbb&quot;</span> -&gt;</span><br><span class="line">    <span class="title class_">Logger</span>.debug(<span class="string">&quot;bbb&quot;</span>)</span><br><span class="line">  _ -&gt;</span><br><span class="line">    <span class="title class_">Logger</span>.debug(<span class="string">&quot;default&quot;</span>)</span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>

<h3 id="with"><a href="#with" class="headerlink" title="with"></a>with</h3><ul>
<li>链式匹配，所以待匹配变量无需定义</li>
<li>如果某个 step 失败，之前的还是会成功执行</li>
</ul>
<figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">defmodule</span> <span class="title">WithDemo</span></span> <span class="keyword">do</span></span><br><span class="line">  <span class="keyword">require</span> <span class="title class_">Logger</span></span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">demo</span></span> <span class="keyword">do</span></span><br><span class="line">    <span class="keyword">with</span> &#123;<span class="symbol">:ok</span>, result1&#125; &lt;- step1(),</span><br><span class="line">         &#123;<span class="symbol">:ok</span>, result2&#125; &lt;- step2(result1),</span><br><span class="line">         &#123;<span class="symbol">:ok</span>, result3&#125; &lt;- step3(result2) <span class="keyword">do</span></span><br><span class="line">      <span class="title class_">Logger</span>.debug(<span class="string">&quot;final result <span class="subst">#&#123;result1 + result2 + result3&#125;</span>&quot;</span>)</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">      &#123;<span class="symbol">:error</span>, _&#125; -&gt;</span><br><span class="line">        <span class="title class_">Logger</span>.debug(<span class="string">&quot;某些需要匹配的错误&quot;</span>)</span><br><span class="line"></span><br><span class="line">      _ -&gt;</span><br><span class="line">        <span class="title class_">Logger</span>.debug(<span class="string">&quot;都不匹配，到这里&quot;</span>)</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">step1</span></span>() <span class="keyword">do</span></span><br><span class="line">    <span class="title class_">Logger</span>.debug(<span class="string">&quot;in step1&quot;</span>)</span><br><span class="line">    &#123;<span class="symbol">:ok</span>, <span class="number">111</span>&#125;</span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">step2</span></span>(arg) <span class="keyword">do</span></span><br><span class="line">    <span class="title class_">Logger</span>.debug(<span class="string">&quot;in step2 <span class="subst">#&#123;inspect(arg)&#125;</span>&quot;</span>)</span><br><span class="line">    &#123;<span class="symbol">:ok</span>, <span class="number">222</span>&#125;</span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">step3</span></span>(arg) <span class="keyword">do</span></span><br><span class="line">    <span class="title class_">Logger</span>.debug(<span class="string">&quot;in step2 <span class="subst">#&#123;inspect(arg)&#125;</span>&quot;</span>)</span><br><span class="line">    &#123;<span class="symbol">:ok</span>, <span class="number">333</span>&#125;</span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>

      
    </div>

  </div>

  <div class="article-footer">
    <div class="article-meta pull-left">

    

    
    

    <span class="post-tags">
      <i class="icon-tags"></i>
        <a href="/tags/elixir/">elixir</a>
    </span>
    

    </div>

    
  </div>
</article>



  <article>

  
    
    <h3 class="article-title"><a href="/2025/12/01/elixir-node-visualize/"><span>elixir 之节点可视化</span></a></h3>
    
  

  <div class="article-top-meta">
    <span class="posted-on">
      <a href="/2025/12/01/elixir-node-visualize/" rel="bookmark">
        <time class="entry-date published" datetime="2025-12-01T00:18:10.000Z">
          2025-12-01
        </time>
      </a>
    </span>
  </div>


  

  <div class="article-content">
    <div class="entry">
      
        <p>Phoenix LiveDashboard，从 phoenix 独立出来了</p>
<h2 id="步骤"><a href="#步骤" class="headerlink" title="步骤"></a>步骤</h2><h3 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mix escript.install hex plds</span><br></pre></td></tr></table></figure>

<h3 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">iex --sname aaa@localhost --cookie 123456</span><br><span class="line">plds server --connect aaa@localhost --cookie 123456 --port 9000 --open</span><br></pre></td></tr></table></figure>

<p>注意右上角的节点，别选错了</p>

      
    </div>

  </div>

  <div class="article-footer">
    <div class="article-meta pull-left">

    

    
    

    <span class="post-tags">
      <i class="icon-tags"></i>
        <a href="/tags/elixir/">elixir</a>
    </span>
    

    </div>

    
  </div>
</article>



  <article>

  
    
    <h3 class="article-title"><a href="/2025/12/01/elixir-phoenix-deploy/"><span>elixir phoenix 应用原生发布</span></a></h3>
    
  

  <div class="article-top-meta">
    <span class="posted-on">
      <a href="/2025/12/01/elixir-phoenix-deploy/" rel="bookmark">
        <time class="entry-date published" datetime="2025-12-01T00:16:10.000Z">
          2025-12-01
        </time>
      </a>
    </span>
  </div>


  

  <div class="article-content">
    <div class="entry">
      
        <p><a target="_blank" rel="noopener" href="https://hexdocs.pm/phoenix/deployment.html">参考地址</a></p>
<h2 id="例子"><a href="#例子" class="headerlink" title="例子"></a>例子</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">mix deps.get --only prod</span><br><span class="line">MIX_ENV=prod mix compile</span><br><span class="line"></span><br><span class="line">MIX_ENV=prod mix assets.deploy</span><br><span class="line"><span class="comment"># MIX_ENV=prod mix ecto.migrate</span></span><br><span class="line">MIX_ENV=prod mix release</span><br><span class="line"><span class="built_in">export</span> SECRET_KEY_BASE=`mix phx.gen.secret` PHX_SERVER=<span class="literal">true</span> PHX_HOST=<span class="string">&quot;aaa.com&quot;</span> PORT=9876;</span><br><span class="line">_build/prod/rel/web_demo/bin/web_demo start</span><br></pre></td></tr></table></figure>

      
    </div>

  </div>

  <div class="article-footer">
    <div class="article-meta pull-left">

    

    
    

    <span class="post-tags">
      <i class="icon-tags"></i>
        <a href="/tags/elixir/">elixir</a>
    </span>
    

    </div>

    
  </div>
</article>



  <article>

  
    
    <h3 class="article-title"><a href="/2025/11/30/elixir-normai-deploy/"><span>elixir 普通应用原生发布</span></a></h3>
    
  

  <div class="article-top-meta">
    <span class="posted-on">
      <a href="/2025/11/30/elixir-normai-deploy/" rel="bookmark">
        <time class="entry-date published" datetime="2025-11-30T04:40:05.000Z">
          2025-11-30
        </time>
      </a>
    </span>
  </div>


  

  <div class="article-content">
    <div class="entry">
      
        <h2 id="步骤"><a href="#步骤" class="headerlink" title="步骤"></a>步骤</h2><h3 id="初始化"><a href="#初始化" class="headerlink" title="初始化"></a>初始化</h3><p>会创建 rel 文件夹，带 vm 的配置和环境变量</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mix release.init</span><br></pre></td></tr></table></figure>

<h3 id="指定-release"><a href="#指定-release" class="headerlink" title="指定 release"></a>指定 release</h3><p>如果要生成指定的 release 的名字，则修改 mix.exs</p>
<p>一般不需要</p>
<figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">project</span></span> <span class="keyword">do</span></span><br><span class="line">  [</span><br><span class="line">    .........</span><br><span class="line">    <span class="symbol">releases:</span> releases()</span><br><span class="line">  ]</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">defp</span> <span class="title">releases</span></span> <span class="keyword">do</span></span><br><span class="line">  [</span><br><span class="line">    <span class="symbol">aaa:</span> [</span><br><span class="line">      <span class="symbol">include_executables_for:</span> [<span class="symbol">:unix</span>],</span><br><span class="line">      <span class="symbol">applications:</span> [</span><br><span class="line">        <span class="symbol">demo1:</span> <span class="symbol">:permanent</span>,</span><br><span class="line">        <span class="symbol">demo2:</span> <span class="symbol">:permanent</span></span><br><span class="line">      ]</span><br><span class="line">    ]</span><br><span class="line">  ]</span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>

<p>运行</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">MIX_ENV=prod mix release</span><br><span class="line">MIX_ENV=prod mix release --overwrite</span><br><span class="line">MIX_ENV=prod mix release aaa</span><br></pre></td></tr></table></figure>

<h3 id="指定-vm-参数"><a href="#指定-vm-参数" class="headerlink" title="指定 vm 参数"></a>指定 vm 参数</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">export</span> RELEASE_DISTRIBUTION=name</span><br><span class="line"><span class="built_in">export</span> RELEASE_NODE=aaa@127.0.0.1</span><br><span class="line"><span class="built_in">export</span> RELEASE_COOKIE=123456</span><br><span class="line">bin/abc start_iex</span><br></pre></td></tr></table></figure>

<h3 id="发布"><a href="#发布" class="headerlink" title="发布"></a>发布</h3><p>最终需要的目录</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">_build/prod/rel/<span class="variable">$RELEASE_NAME</span>/</span><br></pre></td></tr></table></figure>

      
    </div>

  </div>

  <div class="article-footer">
    <div class="article-meta pull-left">

    

    
    

    <span class="post-tags">
      <i class="icon-tags"></i>
        <a href="/tags/elixir/">elixir</a>
    </span>
    

    </div>

    
  </div>
</article>



  <article>

  
    
    <h3 class="article-title"><a href="/2025/11/28/elixir-deploy-args/"><span>elixir 发布之参数配置</span></a></h3>
    
  

  <div class="article-top-meta">
    <span class="posted-on">
      <a href="/2025/11/28/elixir-deploy-args/" rel="bookmark">
        <time class="entry-date published" datetime="2025-11-28T03:50:47.000Z">
          2025-11-28
        </time>
      </a>
    </span>
  </div>


  

  <div class="article-content">
    <div class="entry">
      
        <h2 id="位置"><a href="#位置" class="headerlink" title="位置"></a>位置</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ tree rel</span><br><span class="line">rel</span><br><span class="line">├── env.bat.eex</span><br><span class="line">├── env.sh.eex</span><br><span class="line">├── remote.vm.args.eex</span><br><span class="line">└── vm.args.eex</span><br></pre></td></tr></table></figure>

<h2 id="说明"><a href="#说明" class="headerlink" title="说明"></a>说明</h2><h3 id="env-sh-eex"><a href="#env-sh-eex" class="headerlink" title="env.sh.eex"></a>env.sh.eex</h3><p>release 脚本启动之前，可以执行任何操作</p>
<p>运行期加载环境变量</p>
<figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">export <span class="title class_">AAA</span>=&lt;%= <span class="title class_">System</span>.get_env(<span class="string">&quot;ABC&quot;</span>) %&gt;</span><br><span class="line">export <span class="title class_">BBB</span>=<span class="number">12345</span></span><br></pre></td></tr></table></figure>

<p>测试</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">mix release</span><br><span class="line"><span class="built_in">export</span> ABC=<span class="string">&quot;asdasd&quot;</span></span><br><span class="line">_build/dev/rel/demo/bin/demo start_iex</span><br><span class="line">System.get_env(<span class="string">&quot;AAA&quot;</span>)</span><br><span class="line">System.get_env(<span class="string">&quot;ABC&quot;</span>)</span><br><span class="line">System.get_env(<span class="string">&quot;BBB&quot;</span>)</span><br></pre></td></tr></table></figure>

<h3 id="sys-config"><a href="#sys-config" class="headerlink" title="sys.config"></a>sys.config</h3><p>改到 config 目录里面去了</p>
<h3 id="vm-args-eex"><a href="#vm-args-eex" class="headerlink" title="vm.args.eex"></a>vm.args.eex</h3><p>配置虚拟机参数，只支持编译期加载环境变量</p>
<h4 id="编译期"><a href="#编译期" class="headerlink" title="编译期"></a>编译期</h4><p>默认只能编译期加载</p>
<figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">-kernel inet_dist_listen_min &lt;%= <span class="title class_">System</span>.get_env(<span class="string">&quot;DIST_PORT&quot;</span>) %&gt;</span><br><span class="line">-kernel inet_dist_listen_max &lt;%= <span class="title class_">System</span>.get_env(<span class="string">&quot;DIST_PORT&quot;</span>) %&gt;</span><br></pre></td></tr></table></figure>

<p>测试</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">DIST_PORT=5555 mix release</span><br></pre></td></tr></table></figure>

<h4 id="运行期"><a href="#运行期" class="headerlink" title="运行期"></a>运行期</h4><p>运行期加载环境变量为 hack 的方式</p>
<p>env.sh.eex</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">VERSION_DIR=<span class="string">&quot;<span class="subst">$(ls <span class="string">&quot;<span class="variable">$RELEASE_ROOT</span>/releases/&quot;</span> | head -n1)</span>&quot;</span></span><br><span class="line"><span class="built_in">export</span> DIST_PORT=<span class="string">&quot;<span class="variable">$&#123;DIST_PORT:-7878&#125;</span>&quot;</span></span><br><span class="line">sed -i <span class="string">&quot;s/\$&#123;DIST_PORT&#125;/<span class="variable">$&#123;DIST_PORT&#125;</span>/g&quot;</span> \</span><br><span class="line">  <span class="string">&quot;<span class="variable">$RELEASE_ROOT</span>/releases/<span class="variable">$VERSION_DIR</span>/vm.args&quot;</span></span><br></pre></td></tr></table></figure>

<p>vm.args.eex</p>
<figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">-kernel inet_dist_listen_min <span class="variable">$&#123;</span><span class="title class_">DIST_PORT</span>&#125;</span><br><span class="line">-kernel inet_dist_listen_max <span class="variable">$&#123;</span><span class="title class_">DIST_PORT</span>&#125;</span><br></pre></td></tr></table></figure>

<p>测试</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">MIX_ENV=prod mix release</span><br><span class="line">DIST_PORT=5555 _build/prod/rel/demo/bin/demo start_iex</span><br></pre></td></tr></table></figure>

      
    </div>

  </div>

  <div class="article-footer">
    <div class="article-meta pull-left">

    

    
    

    <span class="post-tags">
      <i class="icon-tags"></i>
        <a href="/tags/elixir/">elixir</a>
    </span>
    

    </div>

    
  </div>
</article>



  <article>

  
    
    <h3 class="article-title"><a href="/2025/11/27/elixir-protocol/"><span>elixir 之 protocol</span></a></h3>
    
  

  <div class="article-top-meta">
    <span class="posted-on">
      <a href="/2025/11/27/elixir-protocol/" rel="bookmark">
        <time class="entry-date published" datetime="2025-11-27T03:06:50.000Z">
          2025-11-27
        </time>
      </a>
    </span>
  </div>


  

  <div class="article-content">
    <div class="entry">
      
        <h2 id="说明"><a href="#说明" class="headerlink" title="说明"></a>说明</h2><p>为不同的数据类型定义通用的行为</p>
<h2 id="场景"><a href="#场景" class="headerlink" title="场景"></a>场景</h2><p>给一些类型增加功能，而不修改原有模块</p>
<h2 id="用法"><a href="#用法" class="headerlink" title="用法"></a>用法</h2><figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">defmodule</span> <span class="title">DemoStruct1</span></span> <span class="keyword">do</span></span><br><span class="line">  <span class="keyword">defstruct</span> [<span class="symbol">:aaa</span>, <span class="symbol">:bbb</span>]</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">new</span></span>(aaa, bbb) <span class="keyword">do</span></span><br><span class="line">    %<span class="title class_">DemoStruct1</span>&#123;<span class="symbol">aaa:</span> aaa, <span class="symbol">bbb:</span> bbb&#125;</span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">defmodule</span> <span class="title">DemoStruct2</span></span> <span class="keyword">do</span></span><br><span class="line">  <span class="keyword">defstruct</span> [<span class="symbol">:ccc</span>, <span class="symbol">:ddd</span>]</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">new</span></span>(ccc, ddd) <span class="keyword">do</span></span><br><span class="line">    %<span class="title class_">DemoStruct2</span>&#123;<span class="symbol">ccc:</span> ccc, <span class="symbol">ddd:</span> ddd&#125;</span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>

<figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">defprotocol</span> <span class="title">DemoProtocol</span></span> <span class="keyword">do</span></span><br><span class="line">  <span class="variable">@fallback_to_any</span> <span class="literal">true</span></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">xxx</span></span>(struct_obj, source, dest)</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">defimpl</span> <span class="title">DemoProtocol</span></span>, <span class="symbol">for:</span> <span class="title class_">DemoStruct1</span> <span class="keyword">do</span></span><br><span class="line">  <span class="keyword">require</span> <span class="title class_">Logger</span></span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">xxx</span></span>(%<span class="title class_">DemoStruct1</span>&#123;<span class="symbol">aaa:</span> aaa, <span class="symbol">bbb:</span> bbb&#125;, source, dest) <span class="keyword">do</span></span><br><span class="line">    info = <span class="string">&quot;第一个 <span class="subst">#&#123;inspect(aaa)&#125;</span> <span class="subst">#&#123;inspect(bbb)&#125;</span> <span class="subst">#&#123;inspect(source)&#125;</span> <span class="subst">#&#123;inspect(dest)&#125;</span>&quot;</span></span><br><span class="line">    <span class="title class_">Logger</span>.debug(info)</span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">defimpl</span> <span class="title">DemoProtocol</span></span>, <span class="symbol">for:</span> <span class="title class_">DemoStruct2</span> <span class="keyword">do</span></span><br><span class="line">  <span class="keyword">require</span> <span class="title class_">Logger</span></span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">xxx</span></span>(%<span class="title class_">DemoStruct2</span>&#123;<span class="symbol">ccc:</span> ccc, <span class="symbol">ddd:</span> ddd&#125;, source, dest) <span class="keyword">do</span></span><br><span class="line">    info = <span class="string">&quot;另外一个 <span class="subst">#&#123;inspect(ccc)&#125;</span> <span class="subst">#&#123;inspect(ddd)&#125;</span> <span class="subst">#&#123;inspect(source)&#125;</span> <span class="subst">#&#123;inspect(dest)&#125;</span>&quot;</span></span><br><span class="line">    <span class="title class_">Logger</span>.debug(info)</span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">defimpl</span> <span class="title">DemoProtocol</span></span>, <span class="symbol">for:</span> <span class="title class_">Any</span> <span class="keyword">do</span></span><br><span class="line">  <span class="keyword">require</span> <span class="title class_">Logger</span></span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">xxx</span></span>(object, source, dest) <span class="keyword">do</span></span><br><span class="line">    info = <span class="string">&quot;any 类型 <span class="subst">#&#123;inspect(object)&#125;</span> <span class="subst">#&#123;inspect(source)&#125;</span> <span class="subst">#&#123;inspect(dest)&#125;</span>&quot;</span></span><br><span class="line">    <span class="title class_">Logger</span>.debug(info)</span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>

<figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">defmodule</span> <span class="title">Demo</span></span> <span class="keyword">do</span></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">demo</span></span> <span class="keyword">do</span></span><br><span class="line">    obj1 = <span class="title class_">DemoStruct1</span>.new(<span class="number">111</span>, <span class="number">222</span>)</span><br><span class="line">    <span class="title class_">DemoProtocol</span>.xxx(obj1, <span class="string">&quot;aaaaaa&quot;</span>, <span class="string">&quot;bbbbbbbb&quot;</span>)</span><br><span class="line"></span><br><span class="line">    obj2 = <span class="title class_">DemoStruct2</span>.new(<span class="number">333</span>, <span class="number">444</span>)</span><br><span class="line">    <span class="title class_">DemoProtocol</span>.xxx(obj2, <span class="string">&quot;yyyyyyyyy&quot;</span>, <span class="string">&quot;zzzzzzzzzzzz&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="title class_">DemoProtocol</span>.xxx(<span class="number">111</span>, <span class="string">&quot;11111&quot;</span>, <span class="string">&quot;22222&quot;</span>)</span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>

      
    </div>

  </div>

  <div class="article-footer">
    <div class="article-meta pull-left">

    

    
    

    <span class="post-tags">
      <i class="icon-tags"></i>
        <a href="/tags/elixir/">elixir</a>
    </span>
    

    </div>

    
  </div>
</article>




<nav class="pagination">
  
  
  <a href="/page/2/" class="pagination-next">下一页</a>
  
</nav>
    </main>

    <footer class="site-footer">
  <p class="site-info">
    Proudly powered by <a href="https://hexo.io/" target="_blank">Hexo</a> and
    Theme by <a href="https://github.com/CodeDaraW/Hacker" target="_blank">Hacker</a>
    </br>
    
    &copy; 2025 John Doe
    
  </p>
</footer>
    
    
  </div>
</div>
</body>
</html>